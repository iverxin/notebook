## mkdir、mkdirat、rmdir

```c
// sys/stat.h
int mkdir(const char *pathname, mode_t mode);
int mkdirat(int fd, const char *pathname, mode_t mode);
//0,-1
```

```c
//unistd.h
int rmdir(const char *pathname);
//0,-1
```

- 如果目录的链接计数为0，并且没有其他进程打开此目录，就释放此目录占用的空间。

- 如果链接计数是0，有别的进程打开此目录，在次函数返回前删除最后一个链接及. 和 .. 项。这个目录不能创建新文件，最后一个进程关闭之后再释放目录占用的空间。（这些进城不能在目录下执行其他操作，就相当于没啥用了。）

## 读目录

任何具有访问权限的用户都可以读目录。但是为了防止文件系统混乱，只有**内核才能写目录**

目录的`写`和`执行`权限决定能否创建新的文件和目录。

```c
// dirent.h
DIR *opendir(const char *pathname);
DIR *fdopendir(int fd); //把文件描述符处理为DIR结构

// 成功返回指针，失败返回NULL
struct dirent *readdir(DIR *dp);
//成功返回指针，失败返回NULL
void rewinddir(DIR *dp);
int closedir(DIR *dp);
//0，-1
long telldir(DIR *dp);
//与dp关联的目录中的当前位置
void seekdir(DIR *dp, long loc);

```

DIR结构是一个内部结构，7个函数用这个内部结构保存当前正在被读取的目录的相关信息。

`opendir`和`fdopendir`返回的DIR给下面的5个函数调用

**目录中的各项目录顺序与实现有关，通常不按照字母顺序**



## chdir、fchdir、getcwd

```c
//unistd.h
//制定新的工作目录
int chdir(const char *pathname);
int fchdir(int fd);
//0,-1

char *getcwd(char *buf, size_t size);

```



## 设备特殊文件

- 文件系统所在的存储设备由主、次设备号表示，谁被好数据类型是dev_t。次设备号标识子设备。如在同一个磁盘驱动器上，主设备号相同，次设备号不同。

- major和minor是两个宏用来访问主次设备号。
- 与文件名相关联的st_dev值是文件系统设备号。major和minor访问。
- st_rdev包含设备号。只有字符特殊文件和块特殊文件才有此值。用major和minor访问

st_dev和st_rdev 都在stat(pathname,&buf)的buf中。(struct stat buf;)



## 文件权限

![1567830376735](C:\Users\Spade\Desktop\notebook\linux_programing_pics\1567830376735.png)

![1567830398267](C:\Users\Spade\Desktop\notebook\linux_programing_pics\1567830398267.png)